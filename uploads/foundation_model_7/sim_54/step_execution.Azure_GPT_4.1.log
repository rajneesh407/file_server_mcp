[2025-09-06 08:03:22 UTC] Starting Spark Job with 1 partition(s).
[2025-09-06 08:03:27 UTC] Spark created 5 task(s): 0 ACTIVE, 5 COMPLETED, 0 FAILED tasks
[2025-09-06 08:03:27 UTC] Processed all records
[2025-09-06 08:03:27 UTC] ********** ERRORS **********
[2025-09-06 08:03:27 UTC] [ERROR] 1 record(s) failed with openai.OpenAIError: Missing credentials. Please pass one of `api_key`, `azure_ad_token`, `azure_ad_token_provider`, or the `AZURE_OPENAI_API_KEY` or `AZURE_OPENAI_AD_TOKEN` environment variables.
[2025-09-06 08:03:27 UTC] ---------------------------------------------------------------------------
[2025-09-06 08:03:27 UTC] OpenAIError                               Traceback (most recent call last):
[2025-09-06 08:03:27 UTC]  FoundationModel "Azure GPT 4.1" <v1>, line 13, in <definition>
[2025-09-06 08:03:27 UTC]          3 |     from openai import AzureOpenAI
[2025-09-06 08:03:27 UTC]          5 |     client = AzureOpenAI(
[2025-09-06 08:03:27 UTC]          6 |         azure_endpoint=os.getenv("AZURE_ENDPOINT"),
[2025-09-06 08:03:27 UTC]          7 |         api_key=os.getenv("AZURE_OPENAI_API_KEY"),
[2025-09-06 08:03:27 UTC]          8 |         api_version="2024-12-01-preview",
[2025-09-06 08:03:27 UTC]          9 |     )
[2025-09-06 08:03:27 UTC]         10 |     return client
[2025-09-06 08:03:27 UTC] ---->   13 | client = init()
[2025-09-06 08:03:27 UTC]                       ^^^^^^
[2025-09-06 08:03:27 UTC]         15 | chat_prompt = [{"role": "system", "content": [{"type": "text", "text": text}]}]
[2025-09-06 08:03:27 UTC]     Local variables:
[2025-09-06 08:03:27 UTC]       text          = '\n    Provide the fina...illing)<END TERM>\n    '
[2025-09-06 08:03:27 UTC]       temperature   = 0.0
[2025-09-06 08:03:27 UTC]       system_instruction = 'None'
[2025-09-06 08:03:27 UTC]       cache         = LRUCache({}, maxsize=1024, currsize=0)
[2025-09-06 08:03:27 UTC]  FoundationModel "Azure GPT 4.1" <v1>, line 5, in init
[2025-09-06 08:03:27 UTC]          1 | def init():
[2025-09-06 08:03:27 UTC]          2 |     import os
[2025-09-06 08:03:27 UTC]          3 |     from openai import AzureOpenAI
[2025-09-06 08:03:27 UTC] ---->    5 |     client = AzureOpenAI(
[2025-09-06 08:03:27 UTC]                           ^^^^^^^^^^^^
[2025-09-06 08:03:27 UTC]          6 |         azure_endpoint=os.getenv("AZURE_ENDPOINT"),
[2025-09-06 08:03:27 UTC]                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[2025-09-06 08:03:27 UTC]          7 |         api_key=os.getenv("AZURE_OPENAI_API_KEY"),
[2025-09-06 08:03:27 UTC]                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[2025-09-06 08:03:27 UTC]          8 |         api_version="2024-12-01-preview",
[2025-09-06 08:03:27 UTC]                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[2025-09-06 08:03:27 UTC]          9 |     )
[2025-09-06 08:03:27 UTC]                  ^
[2025-09-06 08:03:27 UTC]         10 |     return client
[2025-09-06 08:03:27 UTC]  File "/opt/corridor/venv/lib/python3.11/site-packages/openai/lib/azure.py", line 195, in AzureOpenAI.__init__
[2025-09-06 08:03:27 UTC]        191 | if azure_ad_token is None:
[2025-09-06 08:03:27 UTC]        192 |     azure_ad_token = os.environ.get("AZURE_OPENAI_AD_TOKEN")
[2025-09-06 08:03:27 UTC]        194 | if api_key is None and azure_ad_token is None and azure_ad_token_provider is None:
[2025-09-06 08:03:27 UTC] ---->  195 |     raise OpenAIError(
[2025-09-06 08:03:27 UTC]        196 |         "Missing credentials. Please pass one of `api_key`, `azure_ad_token`, `azure_ad_token_provider`, or the `AZURE_OPENAI_API_KEY` or `AZURE_OPENAI_AD_TOKEN` environment variables."
[2025-09-06 08:03:27 UTC]        197 |     )
[2025-09-06 08:03:27 UTC]        199 | if api_version is None:
[2025-09-06 08:03:27 UTC] openai.OpenAIError: Missing credentials. Please pass one of `api_key`, `azure_ad_token`, `azure_ad_token_provider`, or the `AZURE_OPENAI_API_KEY` or `AZURE_OPENAI_AD_TOKEN` environment variables.
[2025-09-06 08:03:34 UTC] Execution completed - 0 records ran successfully and 1 records had errors
[2025-09-06 08:03:34 UTC] Got 0 records after execution. Unable to find any data to run reports on.
